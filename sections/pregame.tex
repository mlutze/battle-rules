\section{Pre-gameplay}\label{sec:pregame}

Before a battle starts,
calculations are performed based on the participants' D\&D statistics.
There are 4 steps to the pre-gameplay calculation:

\begin{enumerate}
    \item Organize the participants into heterogeneous units.
    \item Gather the relevant statistics for each unit.
    \item Calculate unscaled statistics for each unit.
    \item Select scaling parameters.
    \item Calculate scaled statistics for each unit.
\end{enumerate}

\input{sections/pregame/organize.tex}
\input{sections/pregame/gather-statistics.tex}
\input{sections/pregame/calculate-unscaled.tex}
\input{sections/pregame/select-parameters.tex}
\input{sections/pregame/calculate-scaled.tex}

\subsection{Variables}

We take a single creature's base statistics along with the number of creatures in a unit
in order to calculate that unit's overall strength.


\subsubsection{Output}

There are two output values.\todo{N output values}
The number of dice is an aggregation of a unit's defensive strength and number.
It is used as a set of hitpoints during combat.
The roll target is an aggregation
of a unit's offensive strength and accuracy \emph{per die}.
Regardless of unit size,
two units of creatures with the same statistics
will always have the same roll target
(but may use a different number of dice).
A lower roll target is stronger,
as the goal is to roll above the target,
resulting in reducing the opponent's number of dice by 1.

\paragraph{Per-creature values}
\begin{itemize}
    \item $n$ (number of dice) -- the number of dice to use for attacks
    \item $t_a$ (target) -- the number to roll above in order to succeed with attack $a$
    \item $x_a$ (extent) -- the maximum number of tiles away from which attack $a$ can be targeted
    \item $m$ (movement speed) -- the number of tiles a unit moves per turn
    \item $e$ (edge length) -- the number of tiles in a unit's edge length
\end{itemize}

\paragraph{Global values}
\begin{itemize}
    \item $s$ (seconds per turn) -- the length of one turn of gameplay in seconds
\end{itemize}

\todo[inline]{explain global/per-creature distinction}

The combination of the two statistics is written $\nicefrac{n}{t_a}$
and read ``$n$ over $t_a$''.

\subsection{Calculations}

The output values are calculated according to the following formulas:

\begin{align*}
\intertext{\textbf{Per-creature values}}
    n   &=
        \left\lfloor
            \frac
                {h u r^P}
                {10^P H}
        \right\rceil \\[2ex]
    t_a &=
        S -
        \left\lfloor
            \frac
                {d_a (10 + b_{a})^P H S}
                {h r^P A}
        \right\rceil \\[2ex]
    x_a &= \left\lceil\frac
        {n_a + l_a}
        {2 G}
        \right\rceil \\[2ex]
    e   &=
        \frac
            {\sqrt{c^2 u}}
            {G} \\[2ex]
\intertext{\textbf{Global values}}
    s   &=
        \frac
            {3 A}
            {H F}
\end{align*}


\subsection{Examples}\label{sec:examples}

We now demonstrate the use of the formulas through examples.

\subsubsection{Unit of 20 Orcs}

An orc has the following relevant statistics:
\begin{itemize}
    \item $h = 15$ HP (2d8 + 6)
    \item $r = 13$ AC
    \item Javelin Attack:
        \begin{itemize}
            \item $b_j = +5$ to hit
            \item $d_j = 6.5$ damage (d6 + 3)
        \end{itemize}
    \item Greataxe Attack:
        \begin{itemize}
            \item $b_g = +5$ to hit
            \item $d_g = 9.5$ damage (d12 + 3)
        \end{itemize}
\end{itemize}

For 20 orcs, given $A = 100$, $H = 100$, $P = 2$, and $S = 20$
\begin{alignat*}{2}
    n   &=
        \left\lfloor
            \frac
                {(15) (20) (13)^2}
                {(10)^2 100}
        \right\rceil
            &=  5
    \\
    t_a &=
        20 -
        \left\lfloor
            \frac
                {(6.5) (10 + 5)^2 (100) (20)}
                {(15) (13)^2 (100)}
        \right\rceil
        + 1
            &=   9
    \\
    t_g &=
        20 -
        \left\lfloor
            \frac
                {(6.5) (10 + 5)^2 (100) (20)}
                {(15) (13)^2 (100)}
        \right\rceil
        + 1
            &=  4
\end{alignat*}

A 20-orc unit then has 6 hit points, and its attacks are
$\nicefrac{6}{8}$ and $\nicefrac{6}{3}$.
\todo[inline]{need to address other stats too}

\subsubsection{Armored vs Unarmored Commoners}

Here we see the effect of armor on the statistics.
A commoner has the following relevant statistics:

\begin{itemize}
    \item $h = 4.5$ HP (1d8)
    \item $r = 10$ AC
    \item Club Attack:
        \begin{itemize}
            \item $b_c = +2$ to hit
            \item $d_c = 2.5$ damage (1d4)
        \end{itemize}
\end{itemize}


For 100 commoners, given $A = 100$, $H = 100$, $P = 2$, $S = 20$

\begin{alignat*}{2}
    n   &=
        \left\lfloor
            \frac
                {(4.5) (100) (10^2)}
                {(10^2) (100)}
        \right\rceil
            &= 4
    \\
    t_c &=
        20 -
        \left\lfloor
            \frac
                {(2.5) (10 + 2)^2 (100) (20)}
                {(4.5) (10)^2 (100)}
        \right\rceil
        + 1
            &= 5
\end{alignat*}

Equipped with chain shirts, the commoners' AC rises to 13.
This affects their statistics as follows:

\begin{alignat*}{2}
    n   &=
        \left\lfloor
            \frac
                {(4.5) (100) (13^2)}
                {(10^2) (100)}
        \right\rceil
            &= 8
    \\
    t_c &=
        20 -
        \left\lfloor
            \frac
                {(2.5) (10 + 2)^2 (100) (20)}
                {(4.5) (13)^2 (100)}
        \right\rceil
        + 1
            &= 12
\end{alignat*}

Note that while the armored commoners have more dice,
representing their superior defense,
their larger die size causes each individual die less likely to land a hit.
As the units have the same size and weapons,
their ought to have the same attacking power.
Confirming the validity of the conversion,
the expected damage of each unit is roughly equivalent:
$4(\frac{16}{20}) = 3.2$ for the unarmored commoners,
and $9(\frac{10}{20}) = 3.6$ for the armored commoners.
The discrepancy lies in the choice of parameters;
a larger choice of $S$ and smaller choice of $H$ and $A$
would lead to a less significant difference in damage.
